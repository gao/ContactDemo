<!-- Simple contactsComponent -->
<script type="text/javascript">

	snow.ui.registerComponent("contact",
		{
			parent: "#secCol",
			emptyParent: true
		},
		{
		build: function(data){
			var contacts = null;
			if (data && data.groupId) {
				contacts = snow.dm.find("contact",{groupId:data.groupId});
			}else{
				contacts = snow.dm.find("contact");
			}

			var $e = null;
			$e = $("#tmpl-contactList").tmpl({"contacts":contacts});
		
			return $e;
		},
		postDisplay:function(){
			var thisComponent = this;
			var $element = this.$element;
			$element.delegate(".contact","click",function(){
				var $contact = $(this);
				$element.find(".contact").each(function(){
					disCheck($(this));
				});
				showCheck($contact);
				
				var contactIds = thisComponent.getCheckedContactIds();
				snow.ui.display("contactInfo",{ids:contactIds});
			});
			
			//e.stopPropagation() can not work if use 'delegate'
			$element.find("input").bind("click",function(e){
				e.stopPropagation();
				var $checkbox = $(this);
				var $contact = $(this).closest(".contact");
				toggleCheck($contact);
				
				var contactIds = thisComponent.getCheckedContactIds();
				snow.ui.display("contactInfo",{ids:contactIds});
			});
			
			$element.find("#all").bind("click",function(e){
				e.preventDefault();
				$element.find(".contact").each(function(){
					showCheck($(this));
				});
				var contactIds = thisComponent.getCheckedContactIds();
				snow.ui.display("contactInfo",{ids:contactIds});
			});
			$element.find("#none").bind("click",function(e){
				e.preventDefault();
				$element.find(".contact").each(function(){
					disCheck($(this));
				});
				var contactIds = thisComponent.getCheckedContactIds();
				snow.ui.display("contactInfo",{ids:contactIds});
			});
			
			//Helper functions
			function showCheck($contact){
				var $checkbox = $contact.find("input");
				$checkbox.attr("checked",true);
				$contact.addClass("checked");
			}
			function disCheck($contact){
				var $checkbox = $contact.find("input");
				$checkbox.removeAttr("checked");
				$contact.removeClass("checked");
			}
			function toggleCheck($contact){
				var $checkbox = $contact.find("input");
				if($checkbox.attr("checked")==true){
					$contact.addClass("checked");
				}else{
					$contact.removeClass("checked");
				}
			}
		},
		getCheckedContactIds:function(){
			var contactIds = [];
			this.$element.find(".contact.checked").each(function(){
				var $contact = $(this);
				var id = $contact.attr("data-obj_id");
				contactIds.push(id);
			});
			return contactIds;
		}
	});

	
	function deleteContact(id){
		snow.dm.remove("contact",id);
		var groupContacts = snow.dm.find("groupcontact",{});
		for(var i=0;i<groupContacts.length;i++){
			var o = groupContacts[i];
			if(id == o.contactId){
				snow.dm.remove("groupcontact",o.id);
			}
		}
		snow.ui.display("contact");
	}

	function deleteGroupContact(id){
		snow.dm.remove("groupcontact",id);
		snow.ui.display("contact");
	}
</script>
<!--  /Simple contactsComponent -->



<script id="tmpl-contactList" type="text/html">
	<div>
		<div id="contacts-content">
			<div class="header">
				<div>Select: <a id="all">All</a> , <a id="none">None</a></div>
			</div>
		{{each contacts}}
			<div class="contact" data-obj_type="contact" data-obj_id="${id}" >
				<div><input type="checkbox" name="contactIds" /><span class="name">${name}</span></div>
			</div>	
				<!--<div> 
					<span class="name">Name: <a class="edit" onclick="snow.ui.display('dialogContact',{id:'${id}'})" >${name}</a></span>
					<span>Address: ${address}</span>
					<span>Phone: ${phone}</span>
				</div> 
				<div class="group"> 
					Groups: 
					{{each groups}}
						<span class="edit groupValue" onclick="deleteGroupContact('${groupContactId}')">${name}&nbsp;&nbsp;x</span>
					{{/each groups}} 
					<span class="edit" onclick="snow.ui.display('groupcontact',{contactId:'${id}'})">(Add Groups)</span>
				</div>
				<div class="del" onclick="deleteContact('${id}')" >Del</div>
				<div class="del"  onclick="snow.ui.display('dialogContact',{id:'${id}'})">Edit&nbsp;</div>
				-->
		{{/each contacts}}
		</div>
	</div>
</script>

